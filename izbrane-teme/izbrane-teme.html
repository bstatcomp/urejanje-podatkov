<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Izbrane teme</title>
  <meta name="description" content="Izbrane teme" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="Izbrane teme" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Izbrane teme" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  


<script src="libs/header-attrs-2.8/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path=""><a href="#iskanje-ponovnih-bolnišničnih-sprejemov-dodajanje-spremenljivk-glede-na-množico-pogojev"><i class="fa fa-check"></i>Iskanje ponovnih bolnišničnih sprejemov – dodajanje spremenljivk glede na množico pogojev</a></li>
<li class="chapter" data-level="" data-path=""><a href="#urejanje-kumulativne-razpredelnice"><i class="fa fa-check"></i>Urejanje kumulativne razpredelnice</a></li>
<li class="chapter" data-level="" data-path=""><a href="#osnove-grafov-z-ggplot2"><i class="fa fa-check"></i>Osnove grafov z ggplot2</a></li>
<li class="chapter" data-level="" data-path=""><a href="#spreminjanje-fontov-na-grafu"><i class="fa fa-check"></i>Spreminjanje fontov na grafu</a></li>
<li class="chapter" data-level="" data-path=""><a href="#shranjevanje-grafov"><i class="fa fa-check"></i>Shranjevanje grafov</a></li>
<li class="chapter" data-level="" data-path=""><a href="#paket-data.table"><i class="fa fa-check"></i>Paket data.table</a></li>
<li class="chapter" data-level="" data-path=""><a href="#povezava-med-r-in-podatkovnimi-bazami"><i class="fa fa-check"></i>Povezava med R in podatkovnimi bazami</a></li>
<li class="chapter" data-level="" data-path=""><a href="#paralelizacija-v-r"><i class="fa fa-check"></i>Paralelizacija v R</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Izbrane teme</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="header">
<h1 class="title">Izbrane teme</h1>
</div>
<div id="iskanje-ponovnih-bolnišničnih-sprejemov-dodajanje-spremenljivk-glede-na-množico-pogojev" class="section level2 unnumbered">
<h2>Iskanje ponovnih bolnišničnih sprejemov – dodajanje spremenljivk glede na množico pogojev</h2>
<p>Predpostavimo, da imamo podatke o hospitalizacijah pacientov (TabelaA) in celotno bazo hospitalizacij (TabelaB). V datoteki Primer.xlsx se nahajata umetno ustvarjena primera teh dveh tabel in željen rezultat.</p>
<p>Tabeli A želimo dodati dva stolpca in sicer <code>Sprejem_DA/NE</code> tipa faktor in <code>Trajanja_b</code>, ki je iz spremeljivke tabele B, a le pri vrsticah, kjer je novo ustvarjena vrednost spremenljivke <code>Sprejem_DA/NE</code> “Da”.</p>
<p>Pogoji za ponoven sprejem so sledeči:</p>
<ul>
<li>V obeh tabelah se mora ID_ZO ujemati.</li>
<li>Vrsta storitve v tabeli B mora imeti ključ 7.</li>
<li>Ponovni sprejem se je moral zgoditi v 30 dneh po zaključku prvega.</li>
</ul>
<p>Preberimo najprej obe tabeli v R. Ker sta obe tabeli na enem listu s parametroma <code>rows</code> in <code>cols</code> določimo točno območje, ki ga želimo prebrati. Nastavimo tudi <code>detectDates = TRUE</code>, da paket <strong>openxlsx</strong> pravilno prebere datume, drugače jih bo prebral kot cela števila. Nazadnje še spremenimo tipe spremenljivk v bolj primerne, ker so privzeto večinoma tipa niz.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(openxlsx)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.setlocale</span>(<span class="at">category =</span> <span class="st">&quot;LC_ALL&quot;</span>, <span class="at">locale =</span> <span class="st">&quot;Slovenian_Slovenia.1250&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;LC_COLLATE=Slovenian_Slovenia.1250;LC_CTYPE=Slovenian_Slovenia.1250;LC_MONETARY=Slovenian_Slovenia.1250;LC_NUMERIC=C;LC_TIME=Slovenian_Slovenia.1250&quot;</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>TabelaA <span class="ot">&lt;-</span> <span class="fu">tibble</span>(openxlsx<span class="sc">::</span><span class="fu">read.xlsx</span>(<span class="st">&quot;./data-raw/Primer.xlsx&quot;</span>, </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">rows =</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">15</span>, <span class="at">cols =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>, </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">detectDates =</span> <span class="cn">TRUE</span>))</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>TabelaB <span class="ot">&lt;-</span> <span class="fu">tibble</span>(openxlsx<span class="sc">::</span><span class="fu">read.xlsx</span>(<span class="st">&quot;./data-raw/Primer.xlsx&quot;</span>, </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">rows =</span> <span class="dv">21</span><span class="sc">:</span><span class="dv">34</span>, <span class="at">cols =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">detectDates =</span> <span class="cn">TRUE</span>))</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>TabelaA <span class="ot">&lt;-</span> TabelaA <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">ID_BZ             =</span> <span class="fu">as.integer</span>(ID_BZ),</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">ID_ZO             =</span> <span class="fu">as.integer</span>(ID_ZO),</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">Vrsta.storitve    =</span> <span class="fu">as.integer</span>(Vrsta.storitve),</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">Naziv.storitve    =</span> <span class="fu">factor</span>(Naziv.storitve, </span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>                             <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;NBO&quot;</span>, <span class="st">&quot;SPP&quot;</span>, <span class="st">&quot;REH&quot;</span>, <span class="st">&quot;BOL&quot;</span>)),</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  Datum.začetka<span class="at">_a   =</span> <span class="fu">as.Date</span>(Datum.začetka_a),</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  Datum.zaključka<span class="at">_a =</span> <span class="fu">as.Date</span>(Datum.zaključka_a),</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  Leto.zaključka    <span class="ot">=</span> <span class="fu">as.integer</span>(Leto.zaključka),</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">Trajanje_a        =</span> <span class="fu">as.double</span>(Trajanje_a))</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>TabelaB <span class="ot">&lt;-</span> TabelaB <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  ID.bolnišničnega<span class="at">.zdravljenja =</span> <span class="fu">as.integer</span>(ID.bolnišničnega.zdravljenja),</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">ID_ZO                        =</span> <span class="fu">as.integer</span>(ID_ZO),</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">Vrsta.storitve               =</span> <span class="fu">as.integer</span>(Vrsta.storitve),</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">Naziv.storitve               =</span> <span class="fu">factor</span>(Naziv.storitve,</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;NBO&quot;</span>, <span class="st">&quot;SPP&quot;</span>, <span class="st">&quot;REH&quot;</span>, <span class="st">&quot;BOL&quot;</span>)),</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  Datum.začetka<span class="at">_b              =</span> <span class="fu">as.Date</span>(Datum.začetka_b),</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  Datum.zaključka<span class="at">_b            =</span> <span class="fu">as.Date</span>(Datum.zaključka_b),</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>  Leto.zaključka<span class="at">.BZ            =</span> <span class="fu">as.integer</span>(Leto.zaključka.BZ),</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">Trajanja_b                   =</span> <span class="fu">as.double</span>(Trajanja_b))</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>TabelaA</span></code></pre></div>
<pre><code>## # A tibble: 12 x 8
##      ID_BZ  ID_ZO Vrsta.storitve Naziv.storitve Datum.začetka_a Datum.zaključka_a Leto.zaključka Trajanje_a
##      &lt;int&gt;  &lt;int&gt;          &lt;int&gt; &lt;fct&gt;          &lt;date&gt;          &lt;date&gt;                     &lt;int&gt;      &lt;dbl&gt;
##  1 2798353 319130              1 SPP            2020-03-13      2020-03-16                  2020       3.08
##  2 3016565 322315              1 SPP            2020-09-29      2020-10-06                  2020       7.19
##  3 2797632 322959              1 SPP            2020-02-28      2020-03-04                  2020       5.16
##  4 2926031 325345              1 SPP            2020-06-23      2020-07-01                  2020       8.09
##  5 2950619 328229              1 SPP            2020-07-24      2020-08-04                  2020      11.2 
##  6 2757024 329757              1 SPP            2019-12-17      2020-01-03                  2020      17.2 
##  7 2937061 336771              1 SPP            2020-07-23      2020-08-07                  2020       5.97
##  8 2783452 337548              1 SPP            2020-02-18      2020-02-26                  2020       8.06
##  9 2896543 338157              1 SPP            2020-06-08      2020-06-13                  2020       5.32
## 10 2926455 340040              1 SPP            2020-07-16      2020-07-30                  2020      14.1 
## 11 2763834 345093              1 SPP            2020-01-28      2020-02-01                  2020       4.23
## 12 2850770 345538              1 SPP            2020-05-13      2020-05-18                  2020       5.1</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>TabelaB</span></code></pre></div>
<pre><code>## # A tibble: 13 x 8
##    ID.bolnišničnega.zdravljenja  ID_ZO Vrsta.storitve Naziv.storitve Datum.začetka_b Datum.zaključka_b Leto.zaključka.BZ Trajanja_b
##                           &lt;int&gt;  &lt;int&gt;          &lt;int&gt; &lt;fct&gt;          &lt;date&gt;          &lt;date&gt;                        &lt;int&gt;      &lt;dbl&gt;
##  1                      2787203 319130              7 NBO            2020-03-17      2020-02-12                     2020       9   
##  2                      2815711 322315              7 NBO            2019-12-18      2020-03-04                     2020      77   
##  3                      3015310 322959              7 NBO            2020-03-10      2020-03-13                     2020       0   
##  4                      2760973 325345              7 NBO            2020-01-15      2020-01-31                     2020       7   
##  5                      2780311 328229              7 NBO            2020-01-20      2020-02-24                     2020      17   
##  6                      2821346 329757              7 NBO            2020-02-08      2020-03-02                     2020      17   
##  7                      2950863 336771              7 NBO            2020-08-03      2020-08-18                     2020      11   
##  8                      2783452 337548              1 SPP            2020-03-01      2020-03-09                     2020       8.06
##  9                      2896543 338157              7 SPP            2020-07-08      2020-07-18                     2020      10   
## 10                      2926455 340040              1 SPP            2020-07-16      2020-07-30                     2020      14.1 
## 11                      2970736 328930              7 NBO            2020-08-02      2020-09-03                     2020      16   
## 12                      2918965 333928              3 REH            2020-06-29      2020-07-10                     2020      11.1 
## 13                      2987891 333928              5 BOL            2020-09-09      2020-09-26                     2020      16.8</code></pre>
<p>Pri spremenljivki <code>Naziv.storitve</code> smo ročno nastavili nivoje v obeh tabelah ker:</p>
<ul>
<li>V tabeli A ni vseh vrednosti in bi privzeto R izpustil nevidene vrednosti.</li>
<li>Z ročnim vnosom zagotovimo, da so tudi vrednosti faktorjev v obeh tabelah enake.</li>
</ul>
<p>Sedaj, ko smo prebrali podatke, najprej samo poiščimo vrstice, katere ustrezajo pogojem za ponovni sprejem.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>RazsirjenA <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(TabelaA, TabelaB, <span class="at">by =</span> <span class="st">&quot;ID_ZO&quot;</span>, </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">&quot;&quot;</span>, <span class="st">&quot;_b&quot;</span>))</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>RazsirjenA <span class="ot">&lt;-</span> RazsirjenA <span class="sc">%&gt;%</span> </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Vrsta.storitve_b <span class="sc">==</span> <span class="dv">7</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Datum.zaključka_a <span class="sc">&lt;</span> Datum.začetka_b,</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>           Datum.začetka_b <span class="sc">&lt;</span> Datum.zaključka_a <span class="sc">+</span> <span class="fu">days</span>(<span class="dv">30</span>))</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>RazsirjenA</span></code></pre></div>
<pre><code>## # A tibble: 3 x 15
##     ID_BZ  ID_ZO Vrsta.storitve Naziv.storitve Datum.začetka_a Datum.zaključka_a Leto.zaključka Trajanje_a ID.bolnišničnega.zdra~ Vrsta.storitve_b Naziv.storitve_b
##     &lt;int&gt;  &lt;int&gt;          &lt;int&gt; &lt;fct&gt;          &lt;date&gt;          &lt;date&gt;                     &lt;int&gt;      &lt;dbl&gt;                  &lt;int&gt;            &lt;int&gt; &lt;fct&gt;           
## 1 2798353 319130              1 SPP            2020-03-13      2020-03-16                  2020       3.08                2787203                7 NBO             
## 2 2797632 322959              1 SPP            2020-02-28      2020-03-04                  2020       5.16                3015310                7 NBO             
## 3 2896543 338157              1 SPP            2020-06-08      2020-06-13                  2020       5.32                2896543                7 SPP             
## # ... with 4 more variables: Datum.začetka_b &lt;date&gt;, Datum.zaključka_b &lt;date&gt;, Leto.zaključka.BZ &lt;int&gt;, Trajanja_b &lt;dbl&gt;</code></pre>
<p>Najprej smo tabeli združili po vrednosti <code>ID_ZO</code>. Tukaj smo uporabili še parameter <code>suffix</code>, da smo ohranili prvotna imena iz tabele A, tabeli B pa dodali "_b". Ostala dva pogoja smo implementirali s funkcijo <code>filter</code>. V tabeli RazsirjenA, so sedaj v stolpcu ID_BZ vrednosti, pri katerih moramo dodati ponovni sprejem. Tukaj predpostavljamo, da je to primarni ključ.</p>
<p>V zadnjem koraku originalni tabeli A v dveh korakih dodamo manjkajoči spremenljivki.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Dodajmo sprejeme.</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>TabelaA <span class="ot">&lt;-</span> TabelaA <span class="sc">%&gt;%</span> </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">&quot;Sprejem_DA/NE&quot;</span> <span class="ot">=</span> <span class="fu">factor</span>(ID_BZ <span class="sc">%in%</span> RazsirjenA<span class="sc">$</span>ID_BZ,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">levels =</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>),</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Da&quot;</span>, <span class="st">&quot;Ne&quot;</span>)))</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Dodajmo trajanja_b.</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="fu">left_join</span>(TabelaA, RazsirjenA <span class="sc">%&gt;%</span> </span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>            <span class="fu">select</span>(ID_ZO, Trajanja_b), <span class="at">by =</span> <span class="st">&quot;ID_ZO&quot;</span>, <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">&quot;&quot;</span>, <span class="st">&quot;&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Trajanja_b =</span> <span class="fu">replace_na</span>(Trajanja_b, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ID_BZ, ID_ZO, <span class="st">&quot;Sprejem_DA/NE&quot;</span>, Trajanja_b)</span></code></pre></div>
<pre><code>## # A tibble: 12 x 4
##      ID_BZ  ID_ZO `Sprejem_DA/NE` Trajanja_b
##      &lt;int&gt;  &lt;int&gt; &lt;fct&gt;                &lt;dbl&gt;
##  1 2798353 319130 Da                       9
##  2 3016565 322315 Ne                       0
##  3 2797632 322959 Da                       0
##  4 2926031 325345 Ne                       0
##  5 2950619 328229 Ne                       0
##  6 2757024 329757 Ne                       0
##  7 2937061 336771 Ne                       0
##  8 2783452 337548 Ne                       0
##  9 2896543 338157 Da                      10
## 10 2926455 340040 Ne                       0
## 11 2763834 345093 Ne                       0
## 12 2850770 345538 Ne                       0</code></pre>
<p>Pri prvem delu uporabljamo operator <code>%in%</code> za delo z množicami in preverimo ali je <code>ID_BZ</code> tabele A v izbranih vrsticah tabele RazsirjenA. Na koncu z levim združevanjem dodamo še vrednosti trajanja_b iz tabele B in izpišemo okrajšan rezultat. Za izpis točno željene tabele je potrebno le spremeniti zadnji select in podatke shraniti nazaj v tabelo A.</p>
</div>
<div id="urejanje-kumulativne-razpredelnice" class="section level2 unnumbered">
<h2>Urejanje kumulativne razpredelnice</h2>
<p>Iz repozitorija slovenskega COVID sledilnika (<a href="https://github.com/sledilnik/data" class="uri">https://github.com/sledilnik/data</a>) prenesemo podatke o kumulativnem številu okuženih glede na spol in starostno kategorijo (<em>age-cases.csv</em>). Preberimo datoteko v našo sejo R:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;./data-raw/age-cases.csv&quot;</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>df</span></code></pre></div>
<pre><code>## # A tibble: 469 x 45
##    date       `age.male.0-4.tod~ `age.male.5-14.to~ `age.male.15-24.t~ `age.male.25-34.t~ `age.male.35-44.t~ `age.male.45-54.t~ `age.male.55-64.~ `age.male.65-74.~
##    &lt;date&gt;                  &lt;dbl&gt;              &lt;dbl&gt;              &lt;dbl&gt;              &lt;dbl&gt;              &lt;dbl&gt;              &lt;dbl&gt;             &lt;dbl&gt;             &lt;dbl&gt;
##  1 2020-03-04                 NA                 NA                 NA                 NA                 NA                 NA                 1                NA
##  2 2020-03-05                 NA                 NA                 NA                  2                  1                 NA                 1                 1
##  3 2020-03-06                 NA                 NA                 NA                  2                  1                  1                 3                 1
##  4 2020-03-07                 NA                 NA                 NA                  4                  1                  1                 3                 1
##  5 2020-03-08                 NA                 NA                 NA                  4                  1                  1                 4                 2
##  6 2020-03-09                 NA                 NA                  1                  5                  1                  1                 5                 4
##  7 2020-03-10                 NA                 NA                  1                  6                  2                  2                 7                 5
##  8 2020-03-11                 NA                  1                  2                 10                  5                  5                 9                 6
##  9 2020-03-12                 NA                  5                  5                 18                  9                  9                15                 6
## 10 2020-03-13                 NA                  5                  8                 21                 10                 16                15                10
## # ... with 459 more rows, and 36 more variables: age.male.75-84.todate &lt;dbl&gt;, age.male.85+.todate &lt;dbl&gt;, age.male.todate &lt;dbl&gt;, age.female.0-4.todate &lt;dbl&gt;,
## #   age.female.5-14.todate &lt;dbl&gt;, age.female.15-24.todate &lt;dbl&gt;, age.female.25-34.todate &lt;dbl&gt;, age.female.35-44.todate &lt;dbl&gt;, age.female.45-54.todate &lt;dbl&gt;,
## #   age.female.55-64.todate &lt;dbl&gt;, age.female.65-74.todate &lt;dbl&gt;, age.female.75-84.todate &lt;dbl&gt;, age.female.85+.todate &lt;dbl&gt;, age.female.todate &lt;dbl&gt;,
## #   age.unknown.0-4.todate &lt;lgl&gt;, age.unknown.5-14.todate &lt;lgl&gt;, age.unknown.15-24.todate &lt;dbl&gt;, age.unknown.25-34.todate &lt;dbl&gt;, age.unknown.35-44.todate &lt;dbl&gt;,
## #   age.unknown.45-54.todate &lt;dbl&gt;, age.unknown.55-64.todate &lt;dbl&gt;, age.unknown.65-74.todate &lt;lgl&gt;, age.unknown.75-84.todate &lt;lgl&gt;, age.unknown.85+.todate &lt;lgl&gt;,
## #   age.unknown.todate &lt;dbl&gt;, age.0-4.todate &lt;dbl&gt;, age.5-14.todate &lt;dbl&gt;, age.15-24.todate &lt;dbl&gt;, age.25-34.todate &lt;dbl&gt;, age.35-44.todate &lt;dbl&gt;,
## #   age.45-54.todate &lt;dbl&gt;, age.55-64.todate &lt;dbl&gt;, age.65-74.todate &lt;dbl&gt;, age.75-84.todate &lt;dbl&gt;, age.85+.todate &lt;dbl&gt;, age.todate &lt;dbl&gt;</code></pre>
<p>Opazimo, da so podatki shranjeni v zelo široki razpredelnici. Vsak stolpec v bistvu hrani 2 spremenljivki – spol in starost. Pretvorimo podatke v urejeno obliko. Začnimo s pretvorbo v daljšo obliko:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>df_tidy <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">&quot;age&quot;</span>), <span class="at">values_to =</span> <span class="st">&quot;cumulative&quot;</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>df_tidy</span></code></pre></div>
<pre><code>## # A tibble: 20,636 x 3
##    date       name                  cumulative
##    &lt;date&gt;     &lt;chr&gt;                      &lt;dbl&gt;
##  1 2020-03-04 age.male.0-4.todate           NA
##  2 2020-03-04 age.male.5-14.todate          NA
##  3 2020-03-04 age.male.15-24.todate         NA
##  4 2020-03-04 age.male.25-34.todate         NA
##  5 2020-03-04 age.male.35-44.todate         NA
##  6 2020-03-04 age.male.45-54.todate         NA
##  7 2020-03-04 age.male.55-64.todate          1
##  8 2020-03-04 age.male.65-74.todate         NA
##  9 2020-03-04 age.male.75-84.todate         NA
## 10 2020-03-04 age.male.85+.todate           NA
## # ... with 20,626 more rows</code></pre>
<p>Naslednji korak je, da stolpec <code>name</code> razdružimo. Izgleda, kot da je ločitveni znak pika, torej uporabimo za separator <code>\\.</code>, saj razdružujemo z regularnim izrazom:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>df_tidy <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">&quot;age&quot;</span>), <span class="at">values_to =</span> <span class="st">&quot;cumulative&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(name, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;delete1&quot;</span>, <span class="st">&quot;sex&quot;</span>, <span class="st">&quot;age&quot;</span>, <span class="st">&quot;delete2&quot;</span>), <span class="st">&quot;</span><span class="sc">\\</span><span class="st">.&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: Expected 4 pieces. Missing pieces filled with `NA` in 6566 rows [11, 22, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 55, 66, 77, 78, 79, 80, ...].</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>df_tidy</span></code></pre></div>
<pre><code>## # A tibble: 20,636 x 6
##    date       delete1 sex   age   delete2 cumulative
##    &lt;date&gt;     &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;        &lt;dbl&gt;
##  1 2020-03-04 age     male  0-4   todate          NA
##  2 2020-03-04 age     male  5-14  todate          NA
##  3 2020-03-04 age     male  15-24 todate          NA
##  4 2020-03-04 age     male  25-34 todate          NA
##  5 2020-03-04 age     male  35-44 todate          NA
##  6 2020-03-04 age     male  45-54 todate          NA
##  7 2020-03-04 age     male  55-64 todate           1
##  8 2020-03-04 age     male  65-74 todate          NA
##  9 2020-03-04 age     male  75-84 todate          NA
## 10 2020-03-04 age     male  85+   todate          NA
## # ... with 20,626 more rows</code></pre>
<p>Dobimo opozorilo. Preverimo v čem je težava, tako da si s funkcijo <code>View()</code> ogledamo celoten tibble. V 11. vrstici opazimo prvo težavo, v stolpcu <code>age</code> imamo vrednost <code>todate</code>. Zakaj je do tega prišlo? Poglejmo imena stolpcev izvirne razpredelnice:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df)</span></code></pre></div>
<pre><code>##  [1] &quot;date&quot;                     &quot;age.male.0-4.todate&quot;      &quot;age.male.5-14.todate&quot;     &quot;age.male.15-24.todate&quot;    &quot;age.male.25-34.todate&quot;   
##  [6] &quot;age.male.35-44.todate&quot;    &quot;age.male.45-54.todate&quot;    &quot;age.male.55-64.todate&quot;    &quot;age.male.65-74.todate&quot;    &quot;age.male.75-84.todate&quot;   
## [11] &quot;age.male.85+.todate&quot;      &quot;age.male.todate&quot;          &quot;age.female.0-4.todate&quot;    &quot;age.female.5-14.todate&quot;   &quot;age.female.15-24.todate&quot; 
## [16] &quot;age.female.25-34.todate&quot;  &quot;age.female.35-44.todate&quot;  &quot;age.female.45-54.todate&quot;  &quot;age.female.55-64.todate&quot;  &quot;age.female.65-74.todate&quot; 
## [21] &quot;age.female.75-84.todate&quot;  &quot;age.female.85+.todate&quot;    &quot;age.female.todate&quot;        &quot;age.unknown.0-4.todate&quot;   &quot;age.unknown.5-14.todate&quot; 
## [26] &quot;age.unknown.15-24.todate&quot; &quot;age.unknown.25-34.todate&quot; &quot;age.unknown.35-44.todate&quot; &quot;age.unknown.45-54.todate&quot; &quot;age.unknown.55-64.todate&quot;
## [31] &quot;age.unknown.65-74.todate&quot; &quot;age.unknown.75-84.todate&quot; &quot;age.unknown.85+.todate&quot;   &quot;age.unknown.todate&quot;       &quot;age.0-4.todate&quot;          
## [36] &quot;age.5-14.todate&quot;          &quot;age.15-24.todate&quot;         &quot;age.25-34.todate&quot;         &quot;age.35-44.todate&quot;         &quot;age.45-54.todate&quot;        
## [41] &quot;age.55-64.todate&quot;         &quot;age.65-74.todate&quot;         &quot;age.75-84.todate&quot;         &quot;age.85+.todate&quot;           &quot;age.todate&quot;</code></pre>
<p>Opazimo, da niso vsi stolpci ločeni s 3 pikami. Imamo tudi stolpce, ki povzemajo. Na primer, <code>age.male.todate</code> vsebuje vsoto vseh okuženih moških do nekega datuma, torej je vsota stolpcev. V urejenih podatkih ne želimo povzemanj, saj ne želimo mešati posameznih podatkov in njihovih vsot. Povzemanja lahko kasneje izračunamo sami. Zadevo rešimo tako, da iz stolpca <code>name</code> v daljši obliki izberemo samo tiste stolpce, ki vsebujejo 3 pike, pri čemer imamo okoli pike vedno nek tekst. Uporabimo <code>str_detect()</code> in regularne izraze:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>df_tidy <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">&quot;age&quot;</span>), <span class="at">values_to =</span> <span class="st">&quot;cumulative&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(name, <span class="st">&quot;[:alpha:]*</span><span class="sc">\\</span><span class="st">.[:alpha:]*</span><span class="sc">\\</span><span class="st">.[0-9-]*</span><span class="sc">\\</span><span class="st">.[:alpha:]*&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(<span class="st">&quot;name&quot;</span>, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;delete1&quot;</span>, <span class="st">&quot;sex&quot;</span>, <span class="st">&quot;age&quot;</span>, <span class="st">&quot;delete2&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">.&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, sex, age, cumulative)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>df_tidy</span></code></pre></div>
<pre><code>## # A tibble: 12,663 x 4
##    date       sex    age   cumulative
##    &lt;date&gt;     &lt;chr&gt;  &lt;chr&gt;      &lt;dbl&gt;
##  1 2020-03-04 male   0-4           NA
##  2 2020-03-04 male   5-14          NA
##  3 2020-03-04 male   15-24         NA
##  4 2020-03-04 male   25-34         NA
##  5 2020-03-04 male   35-44         NA
##  6 2020-03-04 male   45-54         NA
##  7 2020-03-04 male   55-64          1
##  8 2020-03-04 male   65-74         NA
##  9 2020-03-04 male   75-84         NA
## 10 2020-03-04 female 0-4           NA
## # ... with 12,653 more rows</code></pre>
<p>Spremenimo manjkajoče vrednosti v 0:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>df_tidy <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">&quot;age&quot;</span>), <span class="at">values_to =</span> <span class="st">&quot;cumulative&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(name, <span class="st">&quot;[:alpha:]*</span><span class="sc">\\</span><span class="st">.[:alpha:]*</span><span class="sc">\\</span><span class="st">.[0-9-]*</span><span class="sc">\\</span><span class="st">.[:alpha:]*&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(<span class="st">&quot;name&quot;</span>, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;delete1&quot;</span>, <span class="st">&quot;sex&quot;</span>, <span class="st">&quot;age&quot;</span>, <span class="st">&quot;delete2&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">.&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, sex, age, cumulative) <span class="sc">%&gt;%</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cumulative =</span> <span class="fu">replace_na</span>(cumulative, <span class="dv">0</span>))</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>df_tidy</span></code></pre></div>
<pre><code>## # A tibble: 12,663 x 4
##    date       sex    age   cumulative
##    &lt;date&gt;     &lt;chr&gt;  &lt;chr&gt;      &lt;dbl&gt;
##  1 2020-03-04 male   0-4            0
##  2 2020-03-04 male   5-14           0
##  3 2020-03-04 male   15-24          0
##  4 2020-03-04 male   25-34          0
##  5 2020-03-04 male   35-44          0
##  6 2020-03-04 male   45-54          0
##  7 2020-03-04 male   55-64          1
##  8 2020-03-04 male   65-74          0
##  9 2020-03-04 male   75-84          0
## 10 2020-03-04 female 0-4            0
## # ... with 12,653 more rows</code></pre>
<p>Preostane nam še pretvorba kumulativnih podatkov v dnevne. Trenutno imamo za vsako kombinacijo spola in starosti podano vsoto okuženih do tistega datuma, na primer:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>df_tmp <span class="ot">&lt;-</span> <span class="fu">filter</span>(df_tidy, sex <span class="sc">==</span> <span class="st">&quot;female&quot;</span>, age <span class="sc">==</span> <span class="st">&quot;25-34&quot;</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>df_tmp<span class="sc">$</span>cumulative</span></code></pre></div>
<pre><code>##   [1]     0     0     1     3     3     5     8    15    19    22    26    28    30    31    35    38    39    40    44    46    49    51    52    54    55    56
##  [27]    60    63    67    71    72    73    74    77    81    86    90    94    95    95    97    99   101   103   103   106   106   106   107   107   108   109
##  [53]   109   110   110   111   112   112   112   112   112   114   114   114   114   115   115   115   115   115   115   115   115   115   115   115   115   115
##  [79]   115   115   115   116   116   116   116   116   116   116   116   116   116   116   117   118   118   118   118   119   119   120   120   120   120   120
## [105]   120   121   121   122   122   122   124   125   125   125   127   127   127   128   129   132   135   137   142   142   146   148   148   149   151   153
## [131]   153   153   155   158   159   160   161   161   162   164   167   168   169   170   171   172   173   175   177   180   180   180   180   181   181   181
## [157]   181   181   182   183   187   192   193   196   196   196   201   205   209   210   211   214   216   218   220   224   226   228   230   231   234   236
## [183]   239   246   250   254   257   261   269   279   285   297   308   313   326   333   341   354   358   374   375   383   398   406   426   442   455   461
## [209]   475   489   503   517   539   556   560   566   601   632   665   694   727   739   767   817   886   956  1025  1086  1123  1201  1323  1454  1608  1771
## [235]  1915  2001  2121  2360  2588  2743  2868  3001  3046  3127  3293  3424  3544  3658  3720  3767  3856  4029  4180  4309  4440  4524  4570  4690  4827  4990
## [261]  5103  5253  5348  5400  5508  5708  5850  5981  6109  6205  6256  6339  6511  6656  6798  6935  7028  7074  7216  7393  7588  7725  7884  7957  7991  8109
## [287]  8289  8426  8572  8693  8790  8823  8942  9121  9314  9466  9490  9543  9594  9783  9975 10198 10345 10388 10450 10523 10770 11075 11304 11470 11634 11678
## [313] 11716 11869 12032 12172 12286 12411 12457 12478 12637 12759 12890 13011 13134 13178 13206 13334 13476 13597 13692 13809 13853 13887 14014 14115 14221 14310
## [339] 14402 14447 14474 14498 14638 14782 14868 14952 14985 15009 15068 15142 15208 15265 15342 15388 15413 15479 15563 15622 15687 15746 15784 15806 15869 15943
## [365] 16017 16070 16134 16160 16173 16214 16272 16336 16398 16459 16504 16517 16586 16651 16712 16764 16829 16872 16898 16955 17025 17116 17196 17267 17290 17310
## [391] 17401 17501 17602 17688 17762 17814 17831 17848 17931 18044 18112 18200 18243 18263 18342 18433 18485 18534 18579 18615 18634 18686 18769 18829 18904 18965
## [417] 18995 19012 19074 19101 19165 19236 19304 19337 19348 19435 19513 19580 19635 19675 19701 19713 19758 19817 19865 19908 19940 19968 19982 20026 20052 20080
## [443] 20098 20128 20141 20151 20170 20205 20233 20252 20277 20286 20290 20316 20339 20357 20375 20390 20399 20399 20409 20434 20453 20460 20471 20477 20478 20485
## [469] 20494</code></pre>
<p>Kako pretvoriti kumulativne podatke v dnevne? Kumulativnemu vektor moramo enostavno odšteti enak vektor, premaknjen za en korak naprej. Na primer:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>x_cum <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>x_dly <span class="ot">&lt;-</span> x_cum <span class="sc">-</span> <span class="fu">c</span>(<span class="dv">0</span>, x_cum[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>x_cum</span></code></pre></div>
<pre><code>## [1] 1 5 6 7</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>x_dly</span></code></pre></div>
<pre><code>## [1] 1 4 1 1</code></pre>
<p>V R imamo za to funkcijo <code>diff</code>:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>x_cum <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>x_dly <span class="ot">&lt;-</span> <span class="fu">c</span>(x_cum[<span class="dv">1</span>], <span class="fu">diff</span>(x_cum))</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>x_cum</span></code></pre></div>
<pre><code>## [1] 1 5 6 7</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>x_dly</span></code></pre></div>
<pre><code>## [1] 1 4 1 1</code></pre>
<p>Uporabimo sedaj to funkcijo, da dobimo dnevne podatke. Pri tem moramo biti pozorni, da so kumulativne vrednosti podane za vsak spol in starost posebej. Torej moramo podatke tudi grupirati:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>df_tidy <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">&quot;age&quot;</span>), <span class="at">values_to =</span> <span class="st">&quot;cumulative&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(name, <span class="st">&quot;[:alpha:]*</span><span class="sc">\\</span><span class="st">.[:alpha:]*</span><span class="sc">\\</span><span class="st">.[0-9-]*</span><span class="sc">\\</span><span class="st">.[:alpha:]*&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(<span class="st">&quot;name&quot;</span>, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;delete1&quot;</span>, <span class="st">&quot;sex&quot;</span>, <span class="st">&quot;age&quot;</span>, <span class="st">&quot;delete2&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">.&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, sex, age, cumulative) <span class="sc">%&gt;%</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cumulative =</span> <span class="fu">replace_na</span>(cumulative, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sex, age) <span class="sc">%&gt;%</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">daily =</span> <span class="fu">c</span>(cumulative[<span class="dv">1</span>], <span class="fu">diff</span>(cumulative)))</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>df_tidy</span></code></pre></div>
<pre><code>## # A tibble: 12,663 x 5
## # Groups:   sex, age [27]
##    date       sex    age   cumulative daily
##    &lt;date&gt;     &lt;chr&gt;  &lt;chr&gt;      &lt;dbl&gt; &lt;dbl&gt;
##  1 2020-03-04 male   0-4            0     0
##  2 2020-03-04 male   5-14           0     0
##  3 2020-03-04 male   15-24          0     0
##  4 2020-03-04 male   25-34          0     0
##  5 2020-03-04 male   35-44          0     0
##  6 2020-03-04 male   45-54          0     0
##  7 2020-03-04 male   55-64          1     1
##  8 2020-03-04 male   65-74          0     0
##  9 2020-03-04 male   75-84          0     0
## 10 2020-03-04 female 0-4            0     0
## # ... with 12,653 more rows</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>df_tidy <span class="sc">%&gt;%</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sex <span class="sc">==</span> <span class="st">&quot;female&quot;</span>, age <span class="sc">==</span> <span class="st">&quot;25-34&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 469 x 5
## # Groups:   sex, age [1]
##    date       sex    age   cumulative daily
##    &lt;date&gt;     &lt;chr&gt;  &lt;chr&gt;      &lt;dbl&gt; &lt;dbl&gt;
##  1 2020-03-04 female 25-34          0     0
##  2 2020-03-05 female 25-34          0     0
##  3 2020-03-06 female 25-34          1     1
##  4 2020-03-07 female 25-34          3     2
##  5 2020-03-08 female 25-34          3     0
##  6 2020-03-09 female 25-34          5     2
##  7 2020-03-10 female 25-34          8     3
##  8 2020-03-11 female 25-34         15     7
##  9 2020-03-12 female 25-34         19     4
## 10 2020-03-13 female 25-34         22     3
## # ... with 459 more rows</code></pre>
<p>Urejene podatke še shranimo v mapo <code>data-clean</code>:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="st">&quot;./data-clean/&quot;</span>) <span class="co"># Če še ni mape data-clean jo ustvarimo.</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv2</span>(df_tidy, <span class="st">&quot;./data-clean/age-cases-tidy.csv&quot;</span>)</span></code></pre></div>
</div>
<div id="osnove-grafov-z-ggplot2" class="section level2 unnumbered">
<h2>Osnove grafov z ggplot2</h2>
<p>Osnovni paket v tidyverse je <strong>ggplot2</strong>, ki je namenjen izrisovanju grafov. Paket <strong>ggplot2</strong> implementira sistematičen formalni jezik za opisovanje grafov. To naredi paket dosti bolj zmogljiv, vendar na videz tudi bolj zahtevnega.</p>
<p>Osnovna funkcija za izris grafov je <code>ggplot()</code>. Ta že sama po sebi izriše prazen graf.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()</span></code></pre></div>
<p><img src="izbrane-teme_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<p>Če želimo dejanski izris grafa podatkov pa moramo podati še tri ključne elemente:</p>
<ul>
<li><strong>Podatke</strong>.</li>
<li><strong>Tip grafa</strong> – Kako naj bodo podatki predstavljeni na grafu, lahko jih podamo tudi več.</li>
<li><strong>Estetike</strong> – x-os, y-os, barve točk, skupine podatkov, itd.</li>
</ul>
<p>Poglejmo si različne osnovne grafe na podatkih portugalskih požarov.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>pozari <span class="ot">&lt;-</span> <span class="fu">read_csv2</span>(<span class="st">&quot;./data-raw/forest-fires.csv&quot;</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>pozari</span></code></pre></div>
<pre><code>## # A tibble: 517 x 13
##        X     Y month day   FFMC_index DMC_index DC_index ISI_index  temp    RH  wind  rain  area
##    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;      &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1     7     5 mar   fri         86.2      26.2     94.3       5.1   8.2    51   6.7   0       0
##  2     7     4 oct   tue         90.6      35.4    669.        6.7  18      33   0.9   0       0
##  3     7     4 oct   sat         90.6      43.7    687.        6.7  14.6    33   1.3   0       0
##  4     8     6 mar   fri         91.7      33.3     77.5       9     8.3    97   4     0.2     0
##  5     8     6 mar   sun         89.3      51.3    102.        9.6  11.4    99   1.8   0       0
##  6     8     6 aug   sun         92.3      85.3    488        14.7  22.2    29   5.4   0       0
##  7     8     6 aug   mon         92.3      88.9    496.        8.5  24.1    27   3.1   0       0
##  8     8     6 aug   mon         91.5     145.     608.       10.7   8      86   2.2   0       0
##  9     8     6 sep   tue         91       130.     693.        7    13.1    63   5.4   0       0
## 10     7     5 sep   sat         92.5      88      699.        7.1  22.8    40   4     0       0
## # ... with 507 more rows</code></pre>
<p>Izrišimo najprej število požarov glede na posamezen mesec. Tukaj smo pretvorili mesece v ordinalno spremenljivko, da bo tudi izpis avtomatsko urejen po mesecih.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>pozari_per_m <span class="ot">&lt;-</span> pozari <span class="sc">%&gt;%</span> </span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">factor</span>(month, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;jan&quot;</span>, <span class="st">&quot;feb&quot;</span>, <span class="st">&quot;mar&quot;</span>, <span class="st">&quot;apr&quot;</span>, </span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>                                                   <span class="st">&quot;maj&quot;</span>, <span class="st">&quot;jun&quot;</span>, <span class="st">&quot;jul&quot;</span>, <span class="st">&quot;avg&quot;</span>, </span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>                                                   <span class="st">&quot;sep&quot;</span>, <span class="st">&quot;okt&quot;</span>, <span class="st">&quot;nov&quot;</span>, <span class="st">&quot;dec&quot;</span>), </span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">ordered =</span> T)) <span class="sc">%&gt;%</span> <span class="fu">count</span>(month)</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(pozari_per_m, <span class="fu">aes</span>(<span class="at">x =</span> month, <span class="at">y =</span> n)) <span class="sc">+</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="izbrane-teme_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<p>Tip grafa podamo z eno izmed družine funkcij <code>geom_</code>. Lahko podamo tudi več geomov, če so le-ti kompatibilni. Posebej tudi dodajamo estetike. Dodajmo še rdečo črto.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(pozari_per_m, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.integer</span>(month), <span class="at">y =</span> n)) <span class="sc">+</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">colour =</span> <span class="st">&quot;red&quot;</span>))</span></code></pre></div>
<p><img src="izbrane-teme_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<p>Zgornje podatke bi lahko izrisali tudi v obliki stolpičnega diagrama s funkcijo <code>geom_bar()</code>, ki pa že implicitno prešteje število vrstic za vsako vrednost x-a.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(pozari, <span class="fu">aes</span>(<span class="at">x =</span> month)) <span class="sc">+</span> <span class="fu">geom_bar</span>()</span></code></pre></div>
<p><img src="izbrane-teme_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<p>Naredimo še vročinski (heat) diagram.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>pozari_xy <span class="ot">&lt;-</span> pozari <span class="sc">%&gt;%</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(X, Y) <span class="sc">%&gt;%</span> </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">area_sum =</span> <span class="fu">sum</span>(area))</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(pozari_xy, <span class="fu">aes</span>(<span class="at">x =</span> X, <span class="at">y =</span> Y, <span class="at">fill =</span> area_sum)) <span class="sc">+</span> </span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>()</span></code></pre></div>
<p><img src="izbrane-teme_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
</div>
<div id="spreminjanje-fontov-na-grafu" class="section level2 unnumbered">
<h2>Spreminjanje fontov na grafu</h2>
<p>Dodajmo bolj opisna imena osi grafov in naslov.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>pozari_xy <span class="ot">&lt;-</span> pozari <span class="sc">%&gt;%</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(X, Y) <span class="sc">%&gt;%</span> </span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">area_sum =</span> <span class="fu">sum</span>(area))</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(pozari_xy, <span class="fu">aes</span>(<span class="at">x =</span> X, <span class="at">y =</span> Y, <span class="at">fill =</span> area_sum)) <span class="sc">+</span> </span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x     =</span> <span class="st">&quot;X koordinata&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Y koordinata&quot;</span>, </span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Intenziteta požarov glede na koordinate.&quot;</span>,</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill  =</span> <span class="st">&quot;Površina&quot;</span>)</span></code></pre></div>
<p><img src="izbrane-teme_files/figure-html/unnamed-chunk-22-1.png" width="672" />
Da spremenimo pisavo je v R najprej potrebno naložiti nove pisave. Nekaj pisav je že nameščenih, katere lahko vidimo s funkcijo <code>windowsFonts()</code>.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">windowsFonts</span>())</span></code></pre></div>
<pre><code>## $serif
## [1] &quot;TT Times New Roman&quot;
## 
## $sans
## [1] &quot;TT Arial&quot;
## 
## $mono
## [1] &quot;TT Courier New&quot;</code></pre>
<p>Pri prvem poganjanju so ponavadi na OS Windows na voljo le tri pisave. Da namestimo še ostale pisave uporabimo paket <strong>extrafont</strong>. Da paket naloži vse pisave uporabimo <code>font_import()</code>. To funkcijo poženemo samo enkrat, nalaganje pa lahko traja nekaj minut. Nato v R-ju naložime fonte z <code>loadfonts(device = "win")</code>, ki naloži vse pisave, ki jih najde na sistemu.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(extrafont)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="co">#font_import() # Naloži vse pisave, ki jih dobi.</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="fu">loadfonts</span>(<span class="at">device =</span> <span class="st">&quot;win&quot;</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">str_c</span>(<span class="st">&quot;Stevilo najdenih pisav: &quot;</span>, <span class="fu">length</span>(<span class="fu">windowsFonts</span>())))</span></code></pre></div>
<pre><code>## Stevilo najdenih pisav: 207</code></pre>
<p>Izrišimo sedaj graf s pisavo ‘Ravie’:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>pozari_xy <span class="ot">&lt;-</span> pozari <span class="sc">%&gt;%</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(X, Y) <span class="sc">%&gt;%</span> </span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">area_sum =</span> <span class="fu">sum</span>(area))</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(pozari_xy, <span class="fu">aes</span>(<span class="at">x =</span> X, <span class="at">y =</span> Y, <span class="at">fill =</span> area_sum)) <span class="sc">+</span> </span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x     =</span> <span class="st">&quot;X koordinata&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Y koordinata&quot;</span>, </span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Intenziteta požarov glede na koordinate.&quot;</span>,</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill  =</span> <span class="st">&quot;Površina&quot;</span>) <span class="sc">+</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">9</span>, <span class="at">family=</span><span class="st">&quot;Ravie&quot;</span>, <span class="at">face =</span> <span class="st">&quot;italic&quot;</span>))</span></code></pre></div>
<p><img src="izbrane-teme_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
</div>
<div id="shranjevanje-grafov" class="section level2 unnumbered">
<h2>Shranjevanje grafov</h2>
<p>S funkcijo <code>ggsave()</code> iz knjižnice ggplot2 lahko grafe tipa ggplot shranimo v enem izmed popularnih formatov. Dobra praksa dela z grafi je, da jih najprej shranimo v spremenljivko. Nato jih lahko izrišemo ali njihovo podobo shranimo v datoteko:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>graf <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pozari_xy, <span class="fu">aes</span>(<span class="at">x =</span> X, <span class="at">y =</span> Y, <span class="at">fill =</span> area_sum)) <span class="sc">+</span> </span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>()</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="st">&quot;./data-plots/&quot;</span>)</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;./data-plots/graf.jpg&quot;</span>, <span class="at">plot =</span> graf, <span class="at">width =</span> <span class="dv">4</span>, <span class="at">height =</span> <span class="dv">3</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;./data-plots/graf.png&quot;</span>, <span class="at">width =</span> <span class="dv">4</span>, <span class="at">height =</span> <span class="dv">3</span>, <span class="at">dpi =</span> <span class="dv">300</span>) </span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;./data-plots/graf.pdf&quot;</span>, <span class="at">width =</span> <span class="dv">4</span>, <span class="at">height =</span> <span class="dv">3</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="fu">getwd</span>()</span></code></pre></div>
<pre><code>## [1] &quot;C:/Users/Gregor/Documents/shared_files/workshops/urejanje-podatkov/izbrane-teme&quot;</code></pre>
<p>Funkcija <code>ggsave()</code> bo iz končnice sama zaznala željeni format shranjevanja in primerno shranila graf v datoteko.</p>
<p>Za shranjevanje osnovnih R-jevih grafov, pa lahko preusmerite izrise v datoteko.
Shranimo preprost graf v png sliko.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">getwd</span>()</span></code></pre></div>
<pre><code>## [1] &quot;C:/Users/Gregor/Documents/shared_files/workshops/urejanje-podatkov/izbrane-teme&quot;</code></pre>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">&quot;./data-plots/grafR.png&quot;</span>)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pozari<span class="sc">$</span>temp, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(pozari<span class="sc">$</span>wind, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>() <span class="co"># Povrnemo izrise nazaj v R.</span></span></code></pre></div>
<pre><code>## png 
##   2</code></pre>
<p>Izrisujemo lahko tudi v pdf datoteke, kjer bo vsak graf izrisan na svojo stran. Grafi so v pdf datoteki shranjeni vektorsko.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pdf</span>(<span class="st">&quot;./data-plots/grafR.pdf&quot;</span>)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pozari<span class="sc">$</span>temp, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(pozari<span class="sc">$</span>wind, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pozari<span class="sc">$</span>wind, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>() <span class="co"># Povrnemo izrise nazaj v R.</span></span></code></pre></div>
<pre><code>## png 
##   2</code></pre>
</div>
<div id="paket-data.table" class="section level2 unnumbered">
<h2>Paket data.table</h2>
<p>Včasih se srečamo s podatkovnimi množicami, ki imajo veliko število zapisov, na primer milijon, 100 milijonov, ali več. Največja omejitev za delo z velikimi podatkovnimi množicami v R je velikost pomnilnika (ang. memory, RAM), saj R vse podatke hrani v pomnilniku. Za primer, numerični vektor dolžine 100 milijonov zasede 800 MB prostora. V kolikor nam pomnilnik dopušča uporabo podatkov, je naslednja ovira čas procesiranja posameznih operacij. V takšnih primerih je smiselno uporabiti programsko opremo (oziroma pakete), ki so namensko razviti za delo z večjo količino podatkov. V R je temu namenjen paket <strong>data.table</strong>. V tem paketu obstaja objekt <code>data.table</code>, ki je drugačna različica <code>data.frame</code>. Data table ima tri dimenzije <code>data.table[i, j, by]</code>:</p>
<ul>
<li><code>i</code> Izbira vrstic in urejanje glede na vrednosti v stolpcih. V dplyr sta za to na voljo glagola <code>filter()</code> in <code>arrange()</code>.</li>
<li><code>j</code> Izbira stolpcev, spreminjanje vrednosti stolpcev in povzemanje. V dplyr so za to na voljo glagoli <code>select()</code>, <code>mutate()</code> in <code>summarise()</code>.</li>
<li><code>by</code> Kako združimo podatke pri operacijah. V dplyr je za to na voljo glagol <code>group_by()</code>.</li>
</ul>
<p>Paketa data.table ne bomo spoznali podrobneje, v kolikor želite več informacij predlagamo ta uvod v paket: <a href="https://cran.r-project.org/web/packages/data.table/vignettes/datatable-intro.html" class="uri">https://cran.r-project.org/web/packages/data.table/vignettes/datatable-intro.html</a>. Za diskusijo o razlikah, prednostih in slabostih obeh paketov (dplyr in data.table) predlagamo ogled tega vprašanja (in odgovorov): <a href="https://stackoverflow.com/questions/21435339/data-table-vs-dplyr-can-one-do-something-well-the-other-cant-or-does-poorly" class="uri">https://stackoverflow.com/questions/21435339/data-table-vs-dplyr-can-one-do-something-well-the-other-cant-or-does-poorly</a>.</p>
<p>Vsekakor takšnih podatkovnih množic ne smemo zamenjati z velepodatki (big data), kjer so množice tako velike, da standardna programska oprema za delo s podatki z njimi ni zmožna delati. V takih primerih se poslužimo programske opreme za velepodatke, kot so, na primer, Hadoop, MongoDB, Apache Spark, itd.</p>
<p>Paket dplyr lahko razširimo s paketom <strong>dtplyr</strong> (<a href="https://github.com/tidyverse/dtplyr" class="uri">https://github.com/tidyverse/dtplyr</a>), ki ga namestimo z ukazom <code>install.packages(dtplyr)</code>. Ta nam omogoča uporabo sintakse paketa dplyr, z učinkovitostjo paketa data.table. To naredi tako, da v ozadju dplyr kodo prevede v data.table kodo. Sicer vseeno deluje nekoliko počasneje kot data.table, ampak je razlika večinoma zanemarljiva.</p>
<p>Poglejmo si preprost primer, kjer generiramo podatke in na njih izvedemo nekaj operacij. Zadevo bomo naredili v dplyr, data.table in dtplyr ter sočasno merili čas izvajanja operacij. Tudi data.table dopušča uporabo operatorja pipe. V paketu dtplyr imamo funkcijo <code>lazy_dt()</code> katera omogoči t. i. leno ovrednotenje (lazy evaluation). V dplyr se opreacije izvajajo požrešno, ena za drugo, kot so zapisane. Leno ovrednotenje pa omogoča, da se operacije ne izvedejo, dokler na koncu ne kličemo funkcije <code>as_tibble()</code>. To omogoča veliko hitrejšo izvedbo.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dtplyr)</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Generirani podatki, da lahko poljubno nastavimo število primerov. ------------</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>n         <span class="ot">&lt;-</span> <span class="dv">100000000</span></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>x         <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n)</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>price     <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">5000</span>, <span class="dv">100</span>)</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>all_types <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="fu">expand.grid</span>(LETTERS, LETTERS, <span class="dv">0</span><span class="sc">:</span><span class="dv">9</span>), <span class="dv">1</span>, paste, <span class="at">collapse=</span><span class="st">&quot;.&quot;</span>)</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>types     <span class="ot">&lt;-</span> <span class="fu">sample</span>(all_types, n, <span class="at">replace =</span> T)</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>tib_dplyr  <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> x, <span class="at">price =</span> price, <span class="at">type =</span> types)</span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>dt_dtplyr  <span class="ot">&lt;-</span> <span class="fu">lazy_dt</span>(data.table<span class="sc">::</span><span class="fu">data.table</span>(<span class="at">x =</span> x, <span class="at">price =</span> price, </span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>                                             <span class="at">type =</span> types))</span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>dt_dtable  <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">data.table</span>(<span class="at">x =</span> x, <span class="at">price =</span> price, <span class="at">type =</span> types)</span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a><span class="co"># dplyr ------------------------------------------------------------------------</span></span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a>t1 <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a>tib_dplyr <span class="sc">%&gt;%</span> </span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(type) <span class="sc">%&gt;%</span> </span>
<span id="cb61-22"><a href="#cb61-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_price =</span> <span class="fu">mean</span>(price))</span></code></pre></div>
<pre><code>## # A tibble: 6,760 x 2
##    type  mean_price
##    &lt;chr&gt;      &lt;dbl&gt;
##  1 A.A.0      4999.
##  2 A.A.1      5001.
##  3 A.A.2      4998.
##  4 A.A.3      5000.
##  5 A.A.4      5000.
##  6 A.A.5      4999.
##  7 A.A.6      5000.
##  8 A.A.7      4999.
##  9 A.A.8      5000.
## 10 A.A.9      5002.
## # ... with 6,750 more rows</code></pre>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>t2 <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>t2 <span class="sc">-</span> t1</span></code></pre></div>
<pre><code>## Time difference of 12.24985 secs</code></pre>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># data.table -------------------------------------------------------------------</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>t1 <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>dt_dtable[, <span class="fu">sum</span>(price), keyby<span class="ot">=</span>type]</span></code></pre></div>
<pre><code>##        type       V1
##    1: A.A.0 74301633
##    2: A.A.1 74261489
##    3: A.A.2 75041587
##    4: A.A.3 74208535
##    5: A.A.4 73933456
##   ---               
## 6756: Z.Z.5 73947906
## 6757: Z.Z.6 74580987
## 6758: Z.Z.7 74086744
## 6759: Z.Z.8 73811624
## 6760: Z.Z.9 74098284</code></pre>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>t2 <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>t2 <span class="sc">-</span> t1</span></code></pre></div>
<pre><code>## Time difference of 4.883885 secs</code></pre>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># dtplyr -----------------------------------------------------------------------</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>t1 <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>dt_dtplyr <span class="sc">%&gt;%</span> </span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(type) <span class="sc">%&gt;%</span> </span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_price =</span> <span class="fu">mean</span>(price)) <span class="sc">%&gt;%</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6,760 x 2
##    type  mean_price
##    &lt;chr&gt;      &lt;dbl&gt;
##  1 A.A.0      4999.
##  2 A.A.1      5001.
##  3 A.A.2      4998.
##  4 A.A.3      5000.
##  5 A.A.4      5000.
##  6 A.A.5      4999.
##  7 A.A.6      5000.
##  8 A.A.7      4999.
##  9 A.A.8      5000.
## 10 A.A.9      5002.
## # ... with 6,750 more rows</code></pre>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>t2 <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>t2 <span class="sc">-</span> t1</span></code></pre></div>
<pre><code>## Time difference of 4.266872 secs</code></pre>
<p>Opazimo, da dtplyr in data.table delujeta veliko hitreje kot dplyr. Koliko hitreje je odvisno od večih parametrov, na primer, koliko podatkov imamo, koliko različnih skupin v združevanju, katere operacije izvajamo in podobno. Za bolj podrobno časovno primerjavo predlagamo obisk strani <a href="https://github.com/Rdatatable/data.table/wiki/Benchmarks-%3A-Grouping" class="uri">https://github.com/Rdatatable/data.table/wiki/Benchmarks-%3A-Grouping</a> in <a href="https://iyarlin.github.io/2020/05/26/dtplyr_benchmarks/" class="uri">https://iyarlin.github.io/2020/05/26/dtplyr_benchmarks/</a>.</p>
<p>Še ena primerjava kode med paketi, ki pa je v knjigi ne bomo izvedli, zaradi nekoliko večje časovne zahtevnosti:</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># dplyr ------------------------------------------------------------------------</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>t1 <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>tib_dplyr <span class="sc">%&gt;%</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(x <span class="sc">&lt;</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(type) <span class="sc">%&gt;%</span></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">price_stand =</span> (price <span class="sc">-</span> <span class="fu">mean</span>(price)) <span class="sc">/</span> <span class="fu">sd</span>(price)) <span class="sc">%&gt;%</span></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean_price_stand =</span> <span class="fu">mean</span>(price_stand))</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>t2 <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>t2 <span class="sc">-</span> t1</span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a><span class="co"># data.table -------------------------------------------------------------------</span></span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a>t1 <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a>dt_dtable <span class="sc">%&gt;%</span></span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a>  .[x <span class="sc">&lt;</span> <span class="dv">2</span>] <span class="sc">%&gt;%</span></span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true" tabindex="-1"></a>  .[ , price_stand <span class="sc">:</span><span class="er">=</span> (price <span class="sc">-</span> <span class="fu">mean</span>(price)) <span class="sc">/</span> <span class="fu">sd</span>(price), by <span class="ot">=</span> type] <span class="sc">%&gt;%</span></span>
<span id="cb73-17"><a href="#cb73-17" aria-hidden="true" tabindex="-1"></a>  .[ , .(<span class="at">mean_price_stand =</span> <span class="fu">mean</span>(price_stand)), keyby <span class="ot">=</span> type]</span>
<span id="cb73-18"><a href="#cb73-18" aria-hidden="true" tabindex="-1"></a>t2 <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb73-19"><a href="#cb73-19" aria-hidden="true" tabindex="-1"></a>t2 <span class="sc">-</span> t1</span>
<span id="cb73-20"><a href="#cb73-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-21"><a href="#cb73-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-22"><a href="#cb73-22" aria-hidden="true" tabindex="-1"></a><span class="co"># dtplyr -----------------------------------------------------------------------</span></span>
<span id="cb73-23"><a href="#cb73-23" aria-hidden="true" tabindex="-1"></a>t1 <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb73-24"><a href="#cb73-24" aria-hidden="true" tabindex="-1"></a>dt_dtplyr <span class="sc">%&gt;%</span></span>
<span id="cb73-25"><a href="#cb73-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(x <span class="sc">&lt;</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb73-26"><a href="#cb73-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(type) <span class="sc">%&gt;%</span></span>
<span id="cb73-27"><a href="#cb73-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">price_stand =</span> (price <span class="sc">-</span> <span class="fu">mean</span>(price)) <span class="sc">/</span> <span class="fu">sd</span>(price)) <span class="sc">%&gt;%</span></span>
<span id="cb73-28"><a href="#cb73-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean_price_stand =</span> <span class="fu">mean</span>(price_stand)) <span class="sc">%&gt;%</span></span>
<span id="cb73-29"><a href="#cb73-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="co"># To vrstico moramo zapisati, v koliko želimo da se ukaz izvede!</span></span>
<span id="cb73-30"><a href="#cb73-30" aria-hidden="true" tabindex="-1"></a>t2 <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb73-31"><a href="#cb73-31" aria-hidden="true" tabindex="-1"></a>t2 <span class="sc">-</span> t1</span></code></pre></div>
</div>
<div id="povezava-med-r-in-podatkovnimi-bazami" class="section level2 unnumbered">
<h2>Povezava med R in podatkovnimi bazami</h2>
<p>Pogosto podatke pridobimo iz podatkovnih baz, ki so namenjene hranjenju in analizi večjih podatkovnih zbirk. Za delo s podatkovnimi bazami običajno uporabljamo programski jezik SQL. V R obstaja več paketov, ki nam omogočajo povezavo na podatkovno bazo. Najbolj popularni so <strong>DBI</strong>, <strong>odbc</strong> in <strong>dbplyr</strong> (slednja oba temeljita na DBI). Ti paketi delujejo z uveljavljenimi sistemi za upravljanje podatkovnih baz, kot so MySQL, PostgreSQL in SQLite ter veliko komercialnimi podatkovnimi bazami.</p>
<p>Poglejmo si primer uporabe podatkovne baze. Na pomnilniku bomo ustvarili začasno bazo. V praksi bi se s tem povezali na poljubno bazo, več informacij lahko poiščete na: <a href="https://db.rstudio.com/" class="uri">https://db.rstudio.com/</a>.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dbplyr)</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DBI)</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(RSQLite<span class="sc">::</span><span class="fu">SQLite</span>(), <span class="st">&quot;:memory:&quot;</span>) <span class="co"># Ustvarimo začasno bazo (RAM).</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dbWriteTable</span>(con, <span class="st">&quot;age-cases-clean&quot;</span>, df_tidy) <span class="co"># Shranimo podatke v bazo.</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>df_tidy_from_db <span class="ot">&lt;-</span> <span class="fu">dbReadTable</span>(con, <span class="st">&quot;age-cases-clean&quot;</span>) <span class="co"># Preberemo podatke v R.</span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_tidy_from_db)</span></code></pre></div>
<pre><code>##    date  sex   age cumulative daily
## 1 18325 male   0-4          0     0
## 2 18325 male  5-14          0     0
## 3 18325 male 15-24          0     0
## 4 18325 male 25-34          0     0
## 5 18325 male 35-44          0     0
## 6 18325 male 45-54          0     0</code></pre>
<p>Paket dbplyr nam omogoča uporabo sintakse dplyr kar na bazi. Interno bo prevedel dplyr kodo v SQL in poizvedbe (transformacije) izvedel direktno na bazi. S tem lahko potem upravljamo tudi z večjo količino podatkov, kot pa jih lahko naložimo v R! Poglejmo si primer:</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a> <span class="co"># S tbl() dostopamo do razpredelnice na bazi.</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>razpredelnica_na_bazi <span class="ot">&lt;-</span> <span class="fu">tbl</span>(con, <span class="st">&quot;age-cases-clean&quot;</span>)</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>razpredelnica_na_bazi</span></code></pre></div>
<pre><code>## # Source:   table&lt;age-cases-clean&gt; [?? x 5]
## # Database: sqlite 3.35.5 [:memory:]
##     date sex    age   cumulative daily
##    &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;      &lt;dbl&gt; &lt;dbl&gt;
##  1 18325 male   0-4            0     0
##  2 18325 male   5-14           0     0
##  3 18325 male   15-24          0     0
##  4 18325 male   25-34          0     0
##  5 18325 male   35-44          0     0
##  6 18325 male   45-54          0     0
##  7 18325 male   55-64          1     1
##  8 18325 male   65-74          0     0
##  9 18325 male   75-84          0     0
## 10 18325 female 0-4            0     0
## # ... with more rows</code></pre>
<p>Opazimo, da dostopamo do razpredelnice naravnost v bazi. Izračunajmo sedaj vsoto dnevnih obolelih za spol in starost kar na bazi. Najprej pripravimo dplyr kodo:</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>povzemi <span class="ot">&lt;-</span> razpredelnica_na_bazi <span class="sc">%&gt;%</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sex, age) <span class="sc">%&gt;%</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">sum</span>(daily))</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>povzemi <span class="sc">%&gt;%</span> <span class="fu">show_query</span>() <span class="co"># Prikaže prevedeno kodo v SQL.</span></span></code></pre></div>
<pre><code>## Warning: Missing values are always removed in SQL.
## Use `SUM(x, na.rm = TRUE)` to silence this warning
## This warning is displayed only once per session.</code></pre>
<pre><code>## &lt;SQL&gt;
## SELECT `sex`, `age`, SUM(`daily`) AS `sum(daily)`
## FROM `age-cases-clean`
## GROUP BY `sex`, `age`</code></pre>
<p>Preostane nam še, da izvedemo te operacije na bazi. S <code>collect()</code> zberemo rezultate:</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>povzetek <span class="ot">&lt;-</span> povzemi <span class="sc">%&gt;%</span> <span class="fu">collect</span>()</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>povzetek</span></code></pre></div>
<pre><code>## # A tibble: 27 x 3
## # Groups:   sex [3]
##    sex    age   `sum(daily)`
##    &lt;chr&gt;  &lt;chr&gt;        &lt;dbl&gt;
##  1 female 0-4           1059
##  2 female 15-24        12768
##  3 female 25-34        20494
##  4 female 35-44        27100
##  5 female 45-54        26346
##  6 female 5-14          5283
##  7 female 55-64        17972
##  8 female 65-74         9686
##  9 female 75-84         7713
## 10 male   0-4           1207
## # ... with 17 more rows</code></pre>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbDisconnect</span>(con) <span class="co"># Zapremo povezavo do baze.</span></span></code></pre></div>
</div>
<div id="paralelizacija-v-r" class="section level2 unnumbered">
<h2>Paralelizacija v R</h2>
<p>Pogosto se pri delu s podatki srečujemo z nalogami, ki zahtevajo časovno potratno obdelavo. Dober primer tega je učenje metod umetne inteligence. Že relativno preprosti primeri, kot je linearna regresija, lahko trajajo tudi po več ur, če imamo veliko podatkov. Velikokrat potem modele učimo na različnih podmnožicah. Ampak dva modela učena na različnih množicah nimata praktično nič skupnega, torej bi jih načeloma lahko učili hkrati! V danajšnih dneh večina računalnikov premore več procesorskih jeder, ki so namenjena izvajanju operacij, oziroma računanju. Torej lahko te ločene probleme enostavno razdelimo med več procesorjev in bodo ti naloge opravljali hkrati! Na prenosnikih ni nenavadno, da imamo 4 jedra, torej lahko hkrati poženemo 4 procese. Če vsak traja 1 uro, potem tako prihranimo 3 ure! Boljši računalniki imajo tudi več jeder, na primer 32. Če gremo še dlje, lahko vzporedno izvajanje prenesemo na grafične procesne enote (grafične kartice), ki pa imajo tudi nad 8000 procesorskih enot.</p>
<p>Tukaj si bomo pogledali relativno preprost primer paralelizacije, kjer bomo zadeve izvajali vzporedno na procesorskih jedrih glavnega procesorja. Koda je pripravljena tako, da lahko število podatkov poljubno povečamo, in s tem primerjamo časovno zahtevnost obeh pristopov.</p>
<p>Kot primer si bomo pogledali relativno preprost statistični model – linearno regresijo, ki jo bomo učili na dveh ločenih podatkovnih množicah.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>) <span class="co"># Zagotovimo ponovljivost.</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">2000000</span> <span class="co"># Število primerov v podatkih.</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Generiramo podatke.</span></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n)</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>y1 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">4</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> x1, <span class="fl">0.2</span>)</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n)</span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>y2 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">3</span> <span class="sc">-</span> <span class="fl">1.5</span> <span class="sc">*</span> x2, <span class="fl">0.2</span>)</span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>df1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> x1, <span class="at">y =</span> y1)</span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> x2, <span class="at">y =</span> y2)</span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a>df_list <span class="ot">&lt;-</span> <span class="fu">list</span>(df1, df2)</span></code></pre></div>
<p>Da poženemo model na vseh podatkih, bomo uporabili zanko for skozi vse elemente seznama <code>df_list()</code>:</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>t1 <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>() <span class="co"># Za izračun potrebnega časa.</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>my_lms <span class="ot">&lt;-</span> <span class="fu">list</span>() <span class="co"># V ta seznam bomo shranili rezultate.</span></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(df_list)) {</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>  my_lms[[i]] <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> df_list[[i]])</span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>t2 <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>my_lms</span></code></pre></div>
<pre><code>## [[1]]
## 
## Call:
## lm(formula = y ~ x, data = df_list[[i]])
## 
## Coefficients:
## (Intercept)            x  
##           4            2  
## 
## 
## [[2]]
## 
## Call:
## lm(formula = y ~ x, data = df_list[[i]])
## 
## Coefficients:
## (Intercept)            x  
##         3.0         -1.5</code></pre>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co"># t2 - t1</span></span></code></pre></div>
<p>Sedaj pa naredimo enako, ampak tako da bomo uporabili 2 procesorski jedri hkrati. Uporabili bomo paket <code>doParallel</code>. Sintaksa kode je zelo podobna standardni R zanki:</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(doParallel)</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="fu">detectCores</span>() <span class="co"># Preverimo, koliko procesorjev imamo na voljo.</span></span></code></pre></div>
<pre><code>## [1] 4</code></pre>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>nc <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="co"># Število procesorjev.</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>mc <span class="ot">&lt;-</span> <span class="fu">makeCluster</span>(nc) <span class="co"># Ustvarimo cluster 2 procesorjev.</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a><span class="co"># S spodnjim klicem bomo ustvarili log datoteko, kamor se bodo zapisovale</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a><span class="co"># informacije iz vsakega procesorja.</span></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a><span class="fu">clusterEvalQ</span>(mc, <span class="fu">sink</span>(<span class="fu">paste0</span>(<span class="st">&quot;./log&quot;</span>, <span class="fu">Sys.getpid</span>(), <span class="st">&quot;.txt&quot;</span>)))</span></code></pre></div>
<pre><code>## [[1]]
## NULL
## 
## [[2]]
## NULL</code></pre>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">registerDoParallel</span>(mc) <span class="co"># Registriramo cluster.</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>my_lms <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>t1 <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>() <span class="co"># Za izračun potrebnega časa.</span></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a><span class="fu">foreach</span>(<span class="at">i =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(df_list)) <span class="sc">%dopar%</span> {</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">&quot;Računam model: &quot;</span>, i))</span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>  my_lms[[i]] <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> df_list[[i]])</span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [[1]]
## 
## Call:
## lm(formula = y ~ x, data = df_list[[i]])
## 
## Coefficients:
## (Intercept)            x  
##           4            2  
## 
## 
## [[2]]
## 
## Call:
## lm(formula = y ~ x, data = df_list[[i]])
## 
## Coefficients:
## (Intercept)            x  
##         3.0         -1.5</code></pre>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stopCluster</span>(mc) <span class="co"># Ustavimo cluster.</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>t2 <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>() <span class="co"># Za izračun potrebnega časa.</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>my_lms</span></code></pre></div>
<pre><code>## list()</code></pre>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co"># t2 - t1</span></span></code></pre></div>
<p>Predlagamo, da poizkusite tudi sami, ampak z več podatki in da si izpišete razliko v časih. Pri tem najprej preverite, koliko jeder ima vaš računalnik, potrebovali boste vsaj 2. Glede na to, da imamo samo 2 razpredelnici, več kot 2 jeder ni smiselno uporabiti.</p>
</div>
            </section>

          </div>
        </div>
      </div>


    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
},
"search": false
});
});
</script>

</body>

</html>
